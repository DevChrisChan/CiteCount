<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dictionary - CiteCount</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
                background: var(--background-primary, #ffffff);
                color: var(--text-primary, #1f2937);
                height: 100vh;
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }

            /* Dark mode support for text */
            @media (prefers-color-scheme: dark) {
                body {
                    background: var(--background-primary, #0f0f0f);
                    color: var(--text-primary, #f3f4f6);
                }
                .word-title,
                .part-of-speech,
                .definition-text,
                .synonyms-label,
                .synonym-tag,
                .dictionary-footer,
                .no-results-title {
                    color: var(--text-primary, #f3f4f6) !important;
                }
                .example,
                .loading-text,
                .empty-state,
                .no-results-state {
                    color: var(--text-secondary, #a1a1aa) !important;
                }
                .definition-text {
                    border-left-color: var(--accent-color, #60a5fa);
                }
                .synonym-tag {
                    background: var(--surface-color, #374151);
                    color: var(--text-primary, #f3f4f6);
                    border-color: var(--border-primary, #374151);
                }
                .synonym-tag:hover {
                    background: var(--accent-color, #1e40af);
                    color: #fff;
                    border-color: var(--accent-color, #1e40af);
                }
            }

        .dictionary-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .search-section {
            padding: 1.5rem;
            background: var(--surface-color, #f9fafb);
            border-bottom: 1px solid var(--border-primary, #e5e7eb);
            flex-shrink: 0;
        }

        @media (prefers-color-scheme: dark) {
            .search-section {
                background: var(--surface-color, #1f2937);
                border-bottom-color: var(--border-primary, #374151);
            }
        }

        .search-input-wrapper {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .nav-btn {
            padding: 0.75rem;
            background: var(--background-primary, #ffffff);
            color: var(--text-primary, #1f2937);
            border: 1px solid var(--border-primary, #e5e7eb);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        @media (prefers-color-scheme: dark) {
            .nav-btn {
                background: var(--background-primary, #0f0f0f);
                border-color: var(--border-primary, #374151);
            }
        }

        .nav-btn:hover:not(:disabled) {
            background: var(--surface-color, #f3f4f6);
            border-color: var(--accent-color, #1e40af);
        }

        @media (prefers-color-scheme: dark) {
            .nav-btn:hover:not(:disabled) {
                background: var(--surface-color, #1f2937);
            }
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .nav-btn svg {
            width: 20px;
            height: 20px;
        }

        .search-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-primary, #e5e7eb);
            border-radius: 0.5rem;
            font-size: 1rem;
            background: var(--background-primary, #ffffff);
            color: var(--text-primary, #1f2937);
            transition: all 0.2s ease;
        }

        @media (prefers-color-scheme: dark) {
            .search-input {
                background: var(--background-primary, #0f0f0f);
                color: var(--text-primary, #f3f4f6);
                border-color: var(--border-primary, #374151);
            }
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-color, #1e40af);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .search-btn {
            padding: 0.75rem 1.5rem;
            background: var(--accent-color, #1e40af);
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .search-btn:hover:not(:disabled) {
            background: #1e3a8a;
            transform: translateY(-1px);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .content-section {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }

        .definition-container {
            display: none;
            animation: slideIn 0.3s ease;
        }

        .definition-container.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .word-header {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-primary, #e5e7eb);
        }

        .word-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-primary, #1f2937);
            margin-bottom: 0.5rem;
        }

        .word-phonetic {
            font-size: 1.1rem;
            color: var(--text-secondary, #6b7280);
            font-style: italic;
        }

        .definition-item {
            margin-bottom: 1.5rem;
        }

        .part-of-speech {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--accent-color, #1e40af);
            margin-bottom: 0.5rem;
            text-transform: capitalize;
        }

        .definition-text {
            font-size: 1rem;
            line-height: 1.6;
            color: var(--text-primary, #1f2937);
            margin-bottom: 0.5rem;
            padding-left: 1rem;
            border-left: 3px solid var(--accent-color, #1e40af);
        }

        .clickable-word {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .clickable-word:hover {
            color: var(--accent-color, #1e40af);
            text-decoration: underline;
        }

        .example {
            font-size: 0.95rem;
            color: var(--text-secondary, #6b7280);
            margin-top: 0.5rem;
            padding-left: 1rem;
            font-style: italic;
            border-left: 3px solid var(--border-primary, #e5e7eb);
        }

        .synonyms {
            font-size: 0.9rem;
            margin-top: 0.75rem;
            padding-left: 1rem;
        }

        .synonyms-label {
            font-weight: 600;
            color: var(--text-primary, #1f2937);
            margin-right: 0.5rem;
        }

        .synonyms-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.25rem;
        }

        .synonym-tag {
            background: var(--surface-color, #f3f4f6);
            color: var(--text-primary, #1f2937);
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .synonym-tag:hover {
            background: var(--accent-color, #1e40af);
            color: white;
            border-color: var(--accent-color, #1e40af);
        }

        /* Speaker button next to word title */
        .speak-btn {
            background: transparent;
            border: 1px solid transparent;
            padding: 0.25rem;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-primary, #1f2937);
            transition: background 0.12s ease, color 0.12s ease, transform 0.08s ease;
            flex-shrink: 0;
        }

        .speak-btn:hover {
            background: var(--surface-color, #f3f4f6);
            transform: translateY(-1px);
        }

        .speak-btn svg { width: 20px; height: 20px; }


        .loading-state {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading-state.active {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-primary, #e5e7eb);
            border-top-color: var(--accent-color, #1e40af);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            color: var(--text-secondary, #6b7280);
            font-size: 0.95rem;
        }

        .empty-state {
            display: none;
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary, #6b7280);
        }

        .empty-state.active {
            display: block;
        }

        .empty-state-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 1rem;
            opacity: 0.3;
        }

        .error-state {
            display: none;
            padding: 1.5rem;
            background: #fee2e2;
            border: 1px solid #fecaca;
            border-radius: 0.5rem;
            color: #dc2626;
            text-align: center;
        }

        .error-state.active {
            display: block;
        }

        .no-results-state {
            display: none;
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary, #6b7280);
        }

        .no-results-state.active {
            display: block;
        }

        .no-results-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 1rem;
            opacity: 0.3;
        }

        .no-results-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary, #1f2937);
            margin-bottom: 0.5rem;
        }

        .dictionary-footer {
            opacity: 0.8;
            color: var(--text-secondary, #6b7280);
            font-size: 0.9rem;
            line-height: 1.4;
            padding: 0.75rem 1rem;
            text-align: center;
            border-top: 1px solid var(--border-primary, #e5e7eb);
            flex-shrink: 0;
            background: transparent;
        }

        /* Modal shown when page is opened directly (not in an iframe) */
        .embed-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 1rem;
        }

        .embed-modal-overlay.active {
            display: flex;
        }

        .embed-modal {
            max-width: 520px;
            width: 100%;
            background: var(--background-primary, #ffffff);
            color: var(--text-primary, #1f2937);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(2,6,23,0.25);
            padding: 1.25rem 1.25rem;
            text-align: left;
        }

        @media (prefers-color-scheme: dark) {
            .embed-modal { background: #0b1220; color: #f3f4f6; }
            .embed-modal-overlay { background: rgba(2,6,23,0.7); }
        }

        .embed-modal h3 { margin-bottom: 0.5rem; font-size: 1.125rem; }
        .embed-modal p { margin-bottom: 1rem; color: var(--text-secondary, #6b7280); }
        .embed-modal .modal-actions { display: flex; gap: 0.5rem; justify-content: flex-end; }
        .embed-modal .modal-btn { padding: 0.5rem 0.85rem; border-radius: 0.5rem; border: 1px solid transparent; cursor: pointer; }
        .embed-modal .modal-btn.primary { background: var(--accent-color, #1e40af); color: white; border-color: var(--accent-color, #1e40af); }
        .embed-modal .modal-btn.ghost { background: transparent; color: inherit; border-color: var(--border-primary, #e5e7eb); }

        .dictionary-footer.hidden {
            display: none;
        }
        @media (prefers-color-scheme: dark) {
            .error-state {
                background: #7f1d1d;
                border-color: #991b1b;
                color: #fecaca;
            }
        }

        @media (max-width: 768px) {
            .search-section {
                padding: 1rem;
            }

            .content-section {
                padding: 1rem;
            }

            .search-input-wrapper {
                gap: 0.5rem;
            }

            .search-input {
                padding: 0.6rem 0.75rem;
                font-size: 0.95rem;
            }

            .search-btn {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }

            .word-title {
                font-size: 1.5rem;
            }

            .definition-text {
                font-size: 0.95rem;
            }
        }
    </style>
</head>
<body>
    <div class="dictionary-container">
        <div class="search-section">
            <div class="search-input-wrapper">
                <button class="nav-btn" id="backBtn" onclick="navigateBack()" disabled title="Go back">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                </button>
                <button class="nav-btn" id="forwardBtn" onclick="navigateForward()" disabled title="Go forward">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </button>
                <input 
                    type="text" 
                    id="searchInput" 
                    class="search-input" 
                    placeholder="Search for a word..." 
                    autocomplete="off"
                >
                <button class="search-btn" id="searchBtn" onclick="searchWord()">Search</button>
            </div>
        </div>

        <div class="content-section">
            <div class="loading-state" id="loadingState">
                <div class="spinner"></div>
                <div class="loading-text">Loading definition...</div>
            </div>

            <div class="error-state" id="errorState"></div>

            <div class="empty-state active" id="emptyState">
                <svg class="empty-state-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18,2 C19.3807,2 20.5,3.11929 20.5,4.5 L20.5,4.5 L20.5,18.75 C20.5,19.1642 20.1642,19.5 19.75,19.5 L19.75,19.5 L5.5,19.5 C5.5,20.0523 5.94772,20.5 6.5,20.5 L6.5,20.5 L19.75,20.5 C20.1642,20.5 20.5,20.8358 20.5,21.25 C20.5,21.6642 20.1642,22 19.75,22 L19.75,22 L6.5,22 C5.11929,22 4,20.8807 4,19.5 L4,19.5 L4,4.5 C4,3.11929 5.11929,2 6.5,2 L6.5,2 Z M16,5 L8,5 C7.44772,5 7,5.44772 7,6 L7,7 C7,7.55228 7.44772,8 8,8 L16,8 C16.5523,8 17,7.55228 17,7 L17,6 C17,5.44772 16.5523,5 16,5 Z"/>
                </svg>
                <p>Search for a word to see its definition</p>
            </div>

            <div class="no-results-state" id="noResultsState">
                <svg class="no-results-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="M21 21l-4.35-4.35"/>
                    <line x1="11" y1="8" x2="11" y2="14"/>
                    <line x1="8" y1="11" x2="14" y2="11"/>
                </svg>
                <div class="no-results-title">No results found</div>
                <p>We couldn't find a definition for "<span id="searchedWord"></span>". Try checking the spelling or searching for a different word.</p>
            </div>

            <div class="definition-container" id="definitionContainer"></div>
        </div>
        <footer class="dictionary-footer" role="contentinfo">
            <p>Bilingual translation dictionaries are permitted in IB exams for non-language subjects. Make sure to obtain approval with your exam coordinator before use. The current CiteCount dictionary is not yet compliant with IB regulations, and we are working to address this.</p><br>
            <p>Â© <span id="copyrightYear"></span> CiteCount. All rights reserved.</p>
            <p>Content is sourced from Wiktionary under the CC BY-SA 4.0 license.</p>
        </footer>
    </div>

    <!-- Modal shown when page is opened directly (not in an iframe) -->
    <div id="iframeModalOverlay" class="embed-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="iframeModalTitle" style="display:none">
        <div class="embed-modal" role="document">
            <h3 id="iframeModalTitle">Designed as an Exam Timer app</h3>
            <p>This dictionary is intended to be used inside the exam timer app. For the best experience, open it from the exam timer interface.</p>
            <div class="modal-actions">
                <button id="iframeModalDismiss" class="modal-btn ghost">Dismiss</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://freedictionaryapi.com/api/v1/entries/en/';
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const emptyState = document.getElementById('emptyState');
        const noResultsState = document.getElementById('noResultsState');
        const definitionContainer = document.getElementById('definitionContainer');
        const backBtn = document.getElementById('backBtn');
        const forwardBtn = document.getElementById('forwardBtn');
        const footer = document.querySelector('.dictionary-footer');

        // Modal elements for iframe detection
        const iframeModalOverlay = document.getElementById('iframeModalOverlay');
        const iframeModalDismiss = document.getElementById('iframeModalDismiss');

        function showIframeModal() {
            try {
                if (!iframeModalOverlay) return;
                // Respect previous dismissal
                if (localStorage && localStorage.getItem('dictionaryModalDismissed') === '1') return;
                iframeModalOverlay.style.display = 'flex';
                // small timeout to allow CSS transitions if any
                requestAnimationFrame(() => iframeModalOverlay.classList.add('active'));
                document.body.style.overflow = 'hidden';
            } catch (e) {
                console.warn('Failed to show iframe modal', e);
            }
        }

        function hideIframeModal(persist = true) {
            try {
                if (!iframeModalOverlay) return;
                iframeModalOverlay.classList.remove('active');
                iframeModalOverlay.style.display = 'none';
                document.body.style.overflow = '';
                if (persist && localStorage) localStorage.setItem('dictionaryModalDismissed', '1');
            } catch (e) {
                console.warn('Failed to hide iframe modal', e);
            }
        }

        if (iframeModalDismiss) {
            iframeModalDismiss.addEventListener('click', () => hideIframeModal(true));
        }

        // Close when clicking outside the modal
        if (iframeModalOverlay) {
            iframeModalOverlay.addEventListener('click', (ev) => {
                if (ev.target === iframeModalOverlay) hideIframeModal(true);
            });
        }

        // History management
        let searchHistory = [];
        let historyIndex = -1;

        // Handle Enter key in search input
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchWord();
            }
        });

        function updateNavigationButtons() {
            backBtn.disabled = historyIndex <= 0;
            forwardBtn.disabled = historyIndex >= searchHistory.length - 1;
        }

        function navigateBack() {
            if (historyIndex > 0) {
                historyIndex--;
                const word = searchHistory[historyIndex];
                searchInput.value = word;
                searchWord(true); // Pass true to indicate this is a navigation action
            }
        }

        function navigateForward() {
            if (historyIndex < searchHistory.length - 1) {
                historyIndex++;
                const word = searchHistory[historyIndex];
                searchInput.value = word;
                searchWord(true); // Pass true to indicate this is a navigation action
            }
        }

        async function searchWord(isNavigation = false) {
            const word = searchInput.value.trim().toLowerCase();
            
            if (!word) {
                showEmptyState();
                return;
            }

            // Hide footer when searching
            footer.classList.add('hidden');

            // Add to history only if not navigating
            if (!isNavigation) {
                // Remove any forward history if we're not at the end
                if (historyIndex < searchHistory.length - 1) {
                    searchHistory = searchHistory.slice(0, historyIndex + 1);
                }
                
                // Add new word to history if it's different from the last one
                if (searchHistory.length === 0 || searchHistory[searchHistory.length - 1] !== word) {
                    searchHistory.push(word);
                    historyIndex = searchHistory.length - 1;
                }
            }

            updateNavigationButtons();
            showLoadingState();

            try {
                const response = await fetch(`${API_URL}${word}`);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        showNoResults(word);
                    } else {
                        showError('Failed to fetch definition. Please try again.');
                    }
                    return;
                }

                const data = await response.json();
                
                // Check if data has valid entries
                if (!data.entries || data.entries.length === 0) {
                    showNoResults(word);
                    return;
                }
                
                displayDefinition(data);
            } catch (error) {
                console.error('Error fetching definition:', error);
                showError('An error occurred. Please check your connection and try again.');
            }
        }

        function makeWordsClickable(text) {
            // Split text into words while preserving punctuation
            return text.replace(/\b([a-zA-Z]+(?:'[a-zA-Z]+)?)\b/g, (match) => {
                return `<span class="clickable-word" onclick="clickWord('${match.toLowerCase()}')">${match}</span>`;
            });
        }

        function clickWord(word) {
            searchInput.value = word;
            searchWord();
        }

        function displayDefinition(data) {
            hideAllStates();
            definitionContainer.classList.add('active');

            const word = data.word;
            const entries = data.entries || [];

            let html = `
                <div class="word-header">
                    <div style="display:flex;align-items:center;gap:0.5rem;">
                        <div class="word-title">${word}</div>
                        <button class="speak-btn" type="button" data-word="${word}" aria-label="Play pronunciation of ${word}" title="Play pronunciation">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                <path d="M13 3.7446C13 3.27314 12.8728 2.50021 12.1657 2.14424C11.4151 1.76635 10.7163 2.19354 10.3623 2.51158L4.94661 7.43717H3C1.89543 7.43717 1 8.3326 1 9.43717L1.00001 14.6248C1.00001 15.7293 1.89544 16.6248 3.00001 16.6248H4.95001L10.3623 21.4891C10.7175 21.8081 11.416 22.2331 12.1656 21.8554C12.8717 21.4998 13 20.7286 13 20.2561V3.7446Z"/>
                                <path d="M17.336 3.79605L17.0952 3.72886C16.5633 3.58042 16.0117 3.89132 15.8632 4.42329L15.7289 4.90489C15.5804 5.43685 15.8913 5.98843 16.4233 6.13687L16.6641 6.20406C18.9551 6.84336 20.7501 9.14615 20.7501 12.0001C20.7501 14.854 18.9551 17.1568 16.6641 17.7961L16.4233 17.8632C15.8913 18.0117 15.5804 18.5633 15.7289 19.0952L15.8632 19.5768C16.0117 20.1088 16.5633 20.4197 17.0952 20.2713L17.336 20.2041C20.7957 19.2387 23.2501 15.8818 23.2501 12.0001C23.2501 8.11832 20.7957 4.76146 17.336 3.79605Z"/>
                                <path d="M16.3581 7.80239L16.1185 7.73078C15.5894 7.57258 15.0322 7.87329 14.874 8.40243L14.7308 8.88148C14.5726 9.41062 14.8733 9.96782 15.4024 10.126L15.642 10.1976C16.1752 10.3571 16.75 11.012 16.75 12C16.75 12.9881 16.1752 13.643 15.642 13.8024L15.4024 13.874C14.8733 14.0322 14.5726 14.5894 14.7308 15.1185L14.874 15.5976C15.0322 16.1267 15.5894 16.4274 16.1185 16.2692L16.3581 16.1976C18.1251 15.6693 19.25 13.8987 19.25 12C19.25 10.1014 18.1251 8.33068 16.3581 7.80239Z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `;

            entries.forEach((entry) => {
                const partOfSpeech = entry.partOfSpeech || '';
                const senses = entry.senses || [];

                if (partOfSpeech) {
                    html += `<div style="margin-bottom: 1.5rem;">
                        <div class="part-of-speech">${partOfSpeech}</div>`;
                }

                senses.forEach((sense) => {
                    const definition = sense.definition || '';
                    const examples = sense.examples || [];
                    const synonyms = sense.synonyms || [];

                    if (definition) {
                        html += `<div class="definition-item">
                            <div class="definition-text">${makeWordsClickable(definition)}</div>`;

                        if (examples.length > 0) {
                            examples.forEach((example) => {
                                html += `<div class="example">"${makeWordsClickable(example)}"</div>`;
                            });
                        }

                        if (synonyms.length > 0) {
                            html += `<div class="synonyms">
                                <span class="synonyms-label">Synonyms:</span>
                                <div class="synonyms-list">
                                    ${synonyms.map(syn => `<span class="synonym-tag" onclick="searchSynonym('${syn}')">${syn}</span>`).join('')}
                                </div>
                            </div>`;
                        }

                        html += `</div>`;
                    }
                });

                if (partOfSpeech) {
                    html += `</div>`;
                }
            });

            definitionContainer.innerHTML = html;
        }

        function searchSynonym(word) {
            searchInput.value = word;
            searchWord();
        }

        function showLoadingState() {
            hideAllStates();
            loadingState.classList.add('active');
        }

        function showError(message) {
            hideAllStates();
            errorState.textContent = message;
            errorState.classList.add('active');
        }

        function showNoResults(word) {
            hideAllStates();
            document.getElementById('searchedWord').textContent = word;
            noResultsState.classList.add('active');
        }

        function showEmptyState() {
            hideAllStates();
            emptyState.classList.add('active');
            // Show footer only in empty state
            footer.classList.remove('hidden');
        }

        function hideAllStates() {
            loadingState.classList.remove('active');
            errorState.classList.remove('active');
            emptyState.classList.remove('active');
            noResultsState.classList.remove('active');
            definitionContainer.classList.remove('active');
        }

        /* Native pronunciation using the Web Speech API (speechSynthesis) */
        function speakText(text) {
            if (!text) return;
            try {
                if (!('speechSynthesis' in window)) return;
                // Cancel any existing utterances
                window.speechSynthesis.cancel();

                const utter = new SpeechSynthesisUtterance(text);
                // Use the user's browser language if possible
                utter.lang = navigator.language || 'en-US';
                // Slightly slower rate for clarity
                utter.rate = 0.95;
                window.speechSynthesis.speak(utter);
            } catch (e) {
                console.warn('Speech synthesis failed', e);
            }
        }

        // Delegate clicks for dynamically created speaker buttons
        document.addEventListener('click', (ev) => {
            const btn = ev.target.closest && ev.target.closest('.speak-btn');
            if (!btn) return;
            const word = btn.getAttribute('data-word') || btn.textContent || '';
            speakText(word.trim());
        });

        // Auto-focus on input when page loads
        window.addEventListener('DOMContentLoaded', () => {
            searchInput.focus();
            // Set dynamic copyright year
            const yElem = document.getElementById('copyrightYear');
            if (yElem) yElem.textContent = new Date().getFullYear();
            // If this page is opened directly (not embedded in an iframe), show informational modal
            try {
                if (window.self === window.top) {
                    showIframeModal();
                }
            } catch (e) {
                // Cross-origin access to window.top could throw; in that case assume it's embedded and do nothing
            }
        });
    </script>
</body>
</html>
